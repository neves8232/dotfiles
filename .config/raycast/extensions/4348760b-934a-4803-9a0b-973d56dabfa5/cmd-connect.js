"use strict";var g=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var b=Object.prototype.hasOwnProperty;var W=(t,n)=>{for(var r in n)g(t,r,{get:n[r],enumerable:!0})},I=(t,n,r,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of T(n))!b.call(t,i)&&i!==r&&g(t,i,{get:()=>n[i],enumerable:!(o=v(n,i))||o.enumerable});return t};var L=t=>I(g({},"__esModule",{value:!0}),t);var F={};W(F,{default:()=>C});module.exports=L(F);var u=require("react"),e=require("@raycast/api");var f=require("child_process");var S=require("@raycast/api");function l(){let{environmentPath:t}=(0,S.getPreferenceValues)(),n=new Set([...process.env.PATH?.split(":")??[],...t?.split(":")??[]]),r=Array.from(n).join(":");return Object.assign({},process.env,{PATH:r})}var d=l();function w(){return new Promise((t,n)=>{(0,f.exec)("sesh list --json",{env:d},(r,o,i)=>{if(r||i)return console.error("stderr ",i),console.error("error ",r),n("Please upgrade to the latest version of the sesh CLI");let c=JSON.parse(o);return t(c??[])})})}function h(t){return new Promise((n,r)=>{(0,f.exec)(`sesh connect --switch "${t}"`,{env:d},(o,i,c)=>o||c?(console.error("error ",o),console.error("stderr ",c),r(o?.message??c)):n())})}function x(){return new Promise(t=>{(0,f.exec)("tmux ls",{env:d},(n,r,o)=>t(!(n||o)))})}var y=require("@raycast/api"),P=require("child_process");var N=l();function A(){let{openWithApp:t}=(0,y.getPreferenceValues)();return t?new Promise((n,r)=>{(0,P.exec)(`open -a ${t.name}`,{env:N},(o,i,c)=>o||c?r(o?.message??c):n())}):Promise.reject(new Error("No app selected"))}var a=require("react/jsx-runtime");function B(t){switch(t.Src){case"tmux":return{source:e.Icon.Bolt,tintColor:t.Attached>=1?e.Color.Green:e.Color.Blue,tooltip:t.Attached>=1?"Attached":"Detached"};case"tmuxinator":return{source:e.Icon.Box,tintColor:e.Color.Magenta};case"config":return{source:e.Icon.Cog,tintColor:e.Color.SecondaryText};case"zoxide":default:return{source:e.Icon.Folder,tintColor:e.Color.SecondaryText}}}function E(t){if(t!==0)return String(Number.isInteger(t)?t:t.toFixed(2))}function C(){let[t,n]=(0,u.useState)([]),[r,o]=(0,u.useState)(!0);async function i(){try{let s=await w();n(s)}catch(s){await(0,e.showToast)({style:e.Toast.Style.Failure,title:"Couldn't get sessions",message:typeof s=="string"?s:"Unknown reason"})}finally{o(!1)}}(0,u.useEffect)(()=>{(async()=>{if(!await x()){await(0,e.showToast)({style:e.Toast.Style.Failure,title:"tmux isn't running",message:"Please start tmux before using this command."}),o(!1);return}await i()})()},[]);async function c(s){try{o(!0),await h(s),await A(),await(0,e.closeMainWindow)(),await(0,e.clearSearchBar)()}catch(m){await(0,e.showToast)({style:e.Toast.Style.Failure,title:"Couldn't connect to session",message:typeof m=="string"?m:"Unknown reason"})}finally{o(!1)}}return(0,a.jsx)(e.List,{isLoading:r,children:t.map((s,m)=>{let p=[];return s.Src==="tmux"?p.push({icon:e.Icon.AppWindow,text:String(s.Windows),tooltip:s.Windows===1?"Window":"Windows"}):p.push({text:E(s.Score),icon:s.Src==="tmuxinator"?e.Icon.Box:e.Icon.Racket,tooltip:"Score"}),(0,a.jsx)(e.List.Item,{title:s.Name,icon:B(s),accessories:p,actions:(0,a.jsx)(e.ActionPanel,{children:(0,a.jsx)(e.Action,{title:"Connect to Session",onAction:()=>c(s.Name)})})},m)})})}
